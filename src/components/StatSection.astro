---
import studentsData from '@data/students.json';
import Footer from './Footer.astro';

interface StatItem {
  label: string;
  value: number;
  suffix?: string;
}

const stats: StatItem[] = [
  { label: 'Total Students', value: studentsData.totalStudents },
  { label: 'Officers', value: studentsData.officers.length },
  { label: 'Regular Members', value: studentsData.members.length },
  { label: 'Courses Available', value: 7 }
];
---

<section id="statistics" data-color="#050505" class="relative w-full bg-midnight-900 overflow-hidden flex flex-col justify-between h-screen-dynamic">
  <div class="slide-number">03</div>
  
  <div class="flex-grow flex items-center justify-center w-full px-6">
    <div class="container-custom w-full">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
        {stats.map((stat) => (
          <div class="stat-card group bg-white/5 border border-white/10 p-6 md:p-8 text-center transition-all duration-500 hover:border-azure/40 flex flex-col justify-center aspect-square md:aspect-auto opacity-0 translate-y-8">
            <div class="text-3xl sm:text-4xl md:text-6xl font-display font-bold text-white mb-2">
              <span class="stat-number" data-value={stat.value}>{stat.value}</span>{stat.suffix || ''}
            </div>
            <div class="text-azure font-mono text-[8px] md:text-[10px] tracking-[0.2em] md:tracking-[0.3em] uppercase">{stat.label}</div>
          </div>
        ))}
      </div>
    </div>
  </div>

  <div class="w-full">
    <Footer />
  </div>
</section>

<script>
  import { gsap } from 'gsap';

  function playStatsAnim() {
    const cards = document.querySelectorAll('.stat-card');
    if (!cards.length) return;

    gsap.to(cards, {
      y: 0,
      opacity: 1,
      stagger: 0.1,
      duration: 0.8,
      ease: 'power2.out',
      onComplete: () => {
        cards.forEach(card => {
          const numberEl = card.querySelector('.stat-number');
          if (numberEl) {
            const finalValue = parseInt(numberEl.getAttribute('data-value') || '0', 10);
            gsap.fromTo(numberEl, { textContent: '0' }, {
              textContent: finalValue,
              duration: 1.5,
              snap: { textContent: 1 },
              ease: 'power1.out'
            });
          }
        });
      }
    });
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        playStatsAnim();
        observer.disconnect();
      }
    });
  }, { threshold: 0.2 });

  const section = document.getElementById('statistics');
  if (section) observer.observe(section);

  window.addEventListener('slide-enter', ((e: CustomEvent) => {
    if (e.detail.id === 'statistics') playStatsAnim();
  }) as EventListener);
</script>
