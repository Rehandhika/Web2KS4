---
const navItems = [
  { href: '/', label: 'Home' },
  { href: '/anggota', label: 'Squad' },
  { href: '/akademik', label: 'Academic' },
  { href: '/galeri', label: 'Journal' }
];

const currentPath = Astro.url.pathname;
---

<header id="main-header" class="fixed top-0 left-0 right-0 z-[160] py-8 transition-all duration-700 ease-[cubic-bezier(0.16,1,0.3,1)]">
  <nav id="main-nav" class="container-custom">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="group relative z-[170] flex items-center space-x-2">
        <span class="text-2xl font-display font-bold text-white group-hover:text-azure transition-colors duration-500 tracking-tighter">2KS4</span>
        <div class="h-px w-0 bg-azure group-hover:w-8 transition-all duration-500"></div>
      </a>

      <!-- Desktop Menu -->
      <ul class="hidden md:flex items-center space-x-12">
        {navItems.map((item) => (
          <li class="relative overflow-hidden group">
            <a
              href={item.href}
              class:list={[
                'font-mono text-[10px] uppercase tracking-[0.2em] transition-colors duration-500 py-2 block',
                currentPath === item.href ? 'text-azure' : 'text-mist/40 hover:text-white'
              ]}
            >
              {item.label}
            </a>
            <div class:list={[
              'absolute bottom-0 left-0 w-full h-px bg-azure transform transition-transform duration-700 ease-[cubic-bezier(0.16,1,0.3,1)]',
              currentPath === item.href ? 'scale-x-100' : 'scale-x-0 group-hover:scale-x-100 origin-center'
            ]}></div>
          </li>
        ))}
      </ul>

      <!-- Mobile Toggle -->
      <button
        id="menu-toggle"
        class="relative z-[170] group md:hidden flex flex-col items-end space-y-1.5 p-2 focus:outline-none"
        aria-label="Menu"
      >
        <div class="w-8 h-px bg-white group-hover:bg-azure transition-all duration-500 origin-right" id="line-1"></div>
        <div class="w-5 h-px bg-white group-hover:bg-azure transition-all duration-500 origin-right" id="line-2"></div>
      </button>
    </div>
  </nav>
</header>

<!-- Fullscreen Mobile Menu Overlay - MOVED OUTSIDE HEADER -->
<div id="menu-overlay" class="fixed inset-0 bg-midnight-900 z-[155] translate-y-[-100%] flex flex-col justify-center items-center pointer-events-none transition-transform duration-1000 ease-[cubic-bezier(0.16,1,0.3,1)] invisible">
  <div class="absolute inset-0 opacity-10 pointer-events-none">
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-azure/20 blur-[150px] rounded-full"></div>
  </div>
  
  <ul class="text-center space-y-8 relative z-10">
    {navItems.map((item) => (
      <li class="overflow-hidden">
        <a
          href={item.href}
          class="mobile-nav-link block text-5xl sm:text-7xl font-display font-bold text-mist hover:text-azure transition-colors duration-500 opacity-0 translate-y-full"
        >
          {item.label}
        </a>
      </li>
    ))}
  </ul>
  
  <div class="absolute bottom-12 left-0 right-0 text-center opacity-0 translate-y-8" id="menu-footer">
    <span class="font-mono text-[10px] uppercase tracking-[0.3em] text-mist/40">Class of 2026 â€” Champions</span>
  </div>
</div>

<style>
  /* Header Scrolled State */
  #main-header.nav-scrolled {
    @apply py-4 bg-midnight-900/80 backdrop-blur-xl border-b border-white/5 shadow-2xl;
  }

  #main-header.nav-hidden {
    @apply -translate-y-full opacity-0;
  }

  /* Mobile Open State */
  body.menu-open #menu-overlay {
    @apply translate-y-0 pointer-events-auto visible;
  }
</style>

<script>
  import { gsap } from 'gsap';

  const header = document.getElementById('main-header');
  const toggle = document.getElementById('menu-toggle');
  const overlay = document.getElementById('menu-overlay');
  const links = document.querySelectorAll('.mobile-nav-link');
  const footer = document.getElementById('menu-footer');
  const line1 = document.getElementById('line-1');
  const line2 = document.getElementById('line-2');
  
  let isMenuOpen = false;

  const toggleMenu = () => {
    isMenuOpen = !isMenuOpen;
    
    const tl = gsap.timeline({
      defaults: { ease: "expo.inOut", duration: 1 }
    });

    if (isMenuOpen) {
      document.body.classList.add('menu-open');
      tl.to(line1, { rotate: -45, y: 4, width: '32px' }, 0)
        .to(line2, { rotate: 45, y: -4, width: '32px' }, 0)
        .to(links, { 
          opacity: 1, 
          y: 0, 
          stagger: 0.1,
          ease: "power4.out"
        }, 0.3)
        .to(footer, { opacity: 1, y: 0 }, 0.5);
    } else {
      tl.to(links, { opacity: 0, y: '100%', stagger: 0.05, duration: 0.5 })
        .to(footer, { opacity: 0, y: 20, duration: 0.3 }, 0)
        .to(line1, { rotate: 0, y: 0, width: '32px' }, 0.3)
        .to(line2, { rotate: 0, y: 0, width: '20px' }, 0.3)
        .add(() => {
          document.body.classList.remove('menu-open');
        }, 0.4);
    }
  };

  if (toggle) {
    toggle.addEventListener('click', toggleMenu);
    
    links.forEach(link => {
      link.addEventListener('click', () => {
        if (isMenuOpen) toggleMenu();
      });
    });
  }
</script>